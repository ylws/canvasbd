"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,r,o){return r&&e(t.prototype,r),o&&e(t,o),t}}(),CFCMBD=function(){function e(t,r){_classCallCheck(this,e),this.initVal(t,r)}return _createClass(e,[{key:"getId",value:function(e){return document.getElementById(e)}},{key:"initVal",value:function(e,t){var r={id:"canvas",canvas:"",forcxt:"",imgarr:[],count:0,countmax:4,nordraw:"",mousedown:{},dragging:!1,widhei:[1920,1080],imgsrc:"",scale:2,bjXY:[],jtroomid:"jtjs",freeid:"freebd",freearr:[],freeXY:[],freeflag:!1,freecount:0,downcount:0};this.cfg={},_extends(this.cfg,r,e),this.initCommonVal()}},{key:"initCommonVal",value:function(){var e=this.cfg;if(e.jtobj=this.getId(e.jtroomid),e.freeobj=this.getId(e.freeid),e.canvas=this.getId(e.id),e.forcxt=e.canvas.getContext("2d"),e.imgsrc){var t=document.createElement("img");t.src=e.imgsrc,t.width=e.widhei[0],t.height=e.widhei[1],t.onload=function(){e.forcxt.drawImage(t,0,0),e.nordraw=e.forcxt.getImageData(0,0,e.widhei[0],e.widhei[1]),e.forcxt.save(),e.forcxt.restore(),e.imgarr.push(e.nordraw),e.bjXY.push({x:0,y:0,x1:0,y1:0});var r=e.canvas.getBoundingClientRect();e.xx=r.left*(e.canvas.width/r.width),e.yy=r.top*(e.canvas.height/r.height)}}this.eventopt()}},{key:"eventopt",value:function(){var e=this.cfg;e.jtobj.onclick=function(){this.checked?e.countmax=6:e.countmax=4},e.freeobj.onclick=function(){this.checked?e.freeflag=!0:e.freeflag=!1},e.canvas.onmousedown=function(t){var r=t||window.event;if(r.preventDefault(),e.freeflag)e.nordraw=e.forcxt.getImageData(0,0,e.widhei[0],e.widhei[1]),e.mousedown.x=r.clientX*e.scale-e.xx,e.mousedown.y=r.clientY*e.scale-e.yy,e.freeXY[e.freecount]||(e.freeXY[e.freecount]=[],e.freearr[e.freecount]=[]),e.freeXY[e.freecount].push({x:e.mousedown.x,y:e.mousedown.y}),e.dragging=!0;else{if(e.count!=e.imgarr.length-1)for(var o=e.imgarr.length-1;o>e.count;o--)e.imgarr.splice(o,1),e.bjXY.splice(o,1);if(e.count++,e.count>e.countmax)return e.dragging=!1,e.count=e.countmax,!1;e.dragging=!0,e.nordraw=e.forcxt.getImageData(0,0,e.widhei[0],e.widhei[1]),e.mousedown.x=r.clientX*e.scale-e.xx,e.mousedown.y=r.clientY*e.scale-e.yy}},e.canvas.onmousemove=function(t){var r=t||window.event;1==e.dragging&&(r.preventDefault(),e.forcxt.putImageData(e.nordraw,0,0),e.forcxt.beginPath(),e.forcxt.moveTo(e.mousedown.x,e.mousedown.y),e.forcxt.lineTo(r.clientX*e.scale-e.xx,r.clientY*e.scale-e.yy),e.forcxt.strokeStyle="#f00",e.forcxt.lineWidth="4.5",e.forcxt.stroke())},e.canvas.onmouseup=function(t){var r=t||window.event;if(r.preventDefault(),1==e.dragging)if(e.freeflag){e.forcxt.putImageData(e.nordraw,0,0),e.forcxt.moveTo(e.mousedown.x,e.mousedown.y);var o=r.clientX*e.scale-e.xx,n=r.clientY*e.scale-e.yy;e.forcxt.lineTo(o,n),e.forcxt.stroke()}else{e.forcxt.putImageData(e.nordraw,0,0),e.forcxt.beginPath(),e.forcxt.moveTo(e.mousedown.x,e.mousedown.y);var a=r.clientX*e.scale-e.xx,c=r.clientY*e.scale-e.yy;e.forcxt.lineTo(a,c),e.forcxt.stroke(),e.bjXY.push({x:e.mousedown.x,y:e.mousedown.y,x1:a,y1:c}),e.dragging=!1,e.imgarr.push(e.forcxt.getImageData(0,0,e.widhei[0],e.widhei[1]))}},e.canvas.addEventListener("dblclick",function(){e.forcxt.putImageData(e.nordraw,0,0),e.forcxt.moveTo(e.mousedown.x,e.mousedown.y),e.forcxt.lineTo(e.freeXY[e.freecount][0].x,e.freeXY[e.freecount][0].y),e.forcxt.stroke(),e.nordraw=e.forcxt.getImageData(0,0,e.widhei[0],e.widhei[1]),e.freearr[e.freecount].push(e.nordraw),e.dragging=!1,e.freecount++,console.log(e.freeXY,"cfg.freeXY"),console.log(e.freearr,"cfg.freeXY")},!1),this.keyupevent()}},{key:"keyupevent",value:function(){var e=this.cfg;document.onkeyup=function(t){var r=t||window.event;if(r.preventDefault(),r.shiftKey&&"90"==r.keyCode)e.freeflag?(e.freeXY.length<=1?(e.freecount=0,e.freeXY.splice(e.freeXY.length-1,1),e.freearr.splice(e.freearr.length-1,1),e.imgarr&&e.forcxt.putImageData(e.imgarr[e.imgarr.length-1],0,0)):(e.freecount--,e.freeXY.splice(e.freeXY.length-1,1),e.freearr.splice(e.freearr.length-1,1),e.forcxt.putImageData(e.freearr[e.freearr.length-1][0],0,0)),e.nordraw=e.forcxt.getImageData(0,0,e.widhei[0],e.widhei[1])):(--e.count,e.count<=0&&(e.count=0),e.imgarr[e.count]&&e.forcxt.putImageData(e.imgarr[e.count],0,0));else if(r.shiftKey&&"89"==r.keyCode)e.freeflag||(++e.count,e.count>e.imgarr.length-1&&(e.count=e.imgarr.length-1),e.imgarr[e.count]&&e.forcxt.putImageData(e.imgarr[e.count],0,0));else if(r.shiftKey&&"88"==r.keyCode)if(console.log("shift+x 删除数据列表"),e.freeflag)console.log("清除"),e.imgarr&&e.forcxt.putImageData(e.imgarr[e.imgarr.length-1],0,0);else{for(var o=e.imgarr.length-1;o>0;o--,e.count--)e.imgarr.splice(o,1),e.bjXY.splice(o,1);e.imgarr[e.count]&&e.forcxt.putImageData(e.imgarr[e.count],0,0)}}}}]),e}();
export function CFCMBD(param) {
	return new CFCMBD(param)
}