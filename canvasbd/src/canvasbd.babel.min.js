"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),CFCMBD=function(){function e(t,r){_classCallCheck(this,e),this.initVal(t,r)}return _createClass(e,[{key:"getId",value:function(e){return document.getElementById(e)}},{key:"initVal",value:function(e,t){var r={id:"canvas",canvas:"",forcxt:"",imgarr:[],count:0,countmax:4,nordraw:"",firstlinearr:[],secondlinearr:[],thirdlinearr:[],mousedown:{},dragging:!1,widhei:[1920,1080],imgsrc:"",scale:2,bjXY:[],jtroomid:"jtjs",freeid:"freebd",freearr:[],freeXY:[],freeflag:!1,freecount:0,downcount:0};this.cfg={},_extends(this.cfg,r,e),this.initCommonVal()}},{key:"initCommonVal",value:function(){var e=this,t=this.cfg;if(t.jtobj=this.getId(t.jtroomid),t.freeobj=this.getId(t.freeid),t.canvas=this.getId(t.id),t.forcxt=t.canvas.getContext("2d"),t.imgsrc){var r=document.createElement("img");r.src=t.imgsrc,r.width=t.widhei[0],r.height=t.widhei[1],r.onload=function(){t.forcxt.drawImage(r,0,0),t.nordraw=t.forcxt.getImageData(0,0,t.widhei[0],t.widhei[1]),t.forcxt.save(),t.forcxt.restore(),t.imgarr.push(t.nordraw),t.bjXY.push({x:0,y:0,x1:0,y1:0});var a=t.canvas.getBoundingClientRect();t.xx=a.left*(t.canvas.width/a.width),t.yy=a.top*(t.canvas.height/a.height),e.initval()}}this.eventopt()}},{key:"initval",value:function(){var e=this.cfg;if(console.log(e.firstlinearr,"cfg.firstlinearr"),e.nordraw=e.forcxt.getImageData(0,0,e.widhei[0],e.widhei[1]),e.firstlinearr.length>0){var t=e.firstlinearr;this.canvasdraw(t)}if(e.secondlinearr.length>0){var r=e.secondlinearr;this.canvasdraw(r)}if(e.thirdlinearr.length>0){var a=e.thirdlinearr;e.countmax=6,e.jtobj.className="checked",this.canvasdraw(a)}}},{key:"canvasdraw",value:function(e){for(var t=this.cfg,r=0;r<e.length;r++)r%2==0&&(t.count++,t.forcxt.putImageData(t.nordraw,0,0),t.forcxt.beginPath(),t.forcxt.moveTo(e[r].x,e[r].y),t.forcxt.lineTo(e[r+1].x,e[r+1].y),t.forcxt.strokeStyle="#f00",t.forcxt.lineWidth="4.5",t.forcxt.stroke(),t.nordraw=t.forcxt.getImageData(0,0,t.widhei[0],t.widhei[1]),t.imgarr.push(t.forcxt.getImageData(0,0,t.widhei[0],t.widhei[1])),t.bjXY.push({x:e[r].x,y:e[r].y,x1:e[r+1].x,y1:e[r+1].y}))}},{key:"eventopt",value:function(){var e=this.cfg;e.jtobj.onclick=function(){console.log(this.className),"check"==this.className?(this.className="checked",e.countmax=6):(e.countmax=4,this.className="check")},e.freeobj.onclick=function(){"check"==this.className?(this.className="checked",e.freeflag=!0):(e.freeflag=!1,this.className="check")},e.canvas.onmousedown=function(t){var r=t||window.event;if(r.preventDefault(),e.freeflag)e.nordraw=e.forcxt.getImageData(0,0,e.widhei[0],e.widhei[1]),e.mousedown.x=r.clientX*e.scale-e.xx,e.mousedown.y=r.clientY*e.scale-e.yy,e.freeXY[e.freecount]||(e.freeXY[e.freecount]=[],e.freearr[e.freecount]=[]),e.freeXY[e.freecount].push({x:e.mousedown.x,y:e.mousedown.y}),e.dragging=!0;else{if(e.count!=e.imgarr.length-1)for(var a=e.imgarr.length-1;a>e.count;a--)e.imgarr.splice(a,1),e.bjXY.splice(a,1);if(e.count++,e.count>e.countmax)return e.dragging=!1,e.count=e.countmax,!1;e.dragging=!0,e.nordraw=e.forcxt.getImageData(0,0,e.widhei[0],e.widhei[1]),e.mousedown.x=r.clientX*e.scale-e.xx,e.mousedown.y=r.clientY*e.scale-e.yy}},e.canvas.onmousemove=function(t){var r=t||window.event;1==e.dragging&&(r.preventDefault(),e.forcxt.putImageData(e.nordraw,0,0),e.forcxt.beginPath(),e.forcxt.moveTo(e.mousedown.x,e.mousedown.y),e.forcxt.lineTo(r.clientX*e.scale-e.xx,r.clientY*e.scale-e.yy),e.forcxt.strokeStyle="#f00",e.forcxt.lineWidth="4.5",e.forcxt.stroke())},e.canvas.onmouseup=function(t){var r=t||window.event;if(r.preventDefault(),1==e.dragging)if(e.freeflag){e.forcxt.putImageData(e.nordraw,0,0),e.forcxt.moveTo(e.mousedown.x,e.mousedown.y);var a=r.clientX*e.scale-e.xx,n=r.clientY*e.scale-e.yy;e.forcxt.lineTo(a,n),e.forcxt.stroke()}else{e.forcxt.putImageData(e.nordraw,0,0),e.forcxt.beginPath(),e.forcxt.moveTo(e.mousedown.x,e.mousedown.y);var o=r.clientX*e.scale-e.xx,i=r.clientY*e.scale-e.yy;e.forcxt.lineTo(o,i),e.forcxt.stroke(),e.bjXY.push({x:e.mousedown.x,y:e.mousedown.y,x1:o,y1:i}),e.dragging=!1,e.imgarr.push(e.forcxt.getImageData(0,0,e.widhei[0],e.widhei[1]))}},e.canvas.addEventListener("dblclick",function(){e.forcxt.putImageData(e.nordraw,0,0),e.forcxt.moveTo(e.mousedown.x,e.mousedown.y),e.forcxt.lineTo(e.freeXY[e.freecount][0].x,e.freeXY[e.freecount][0].y),e.forcxt.stroke(),e.nordraw=e.forcxt.getImageData(0,0,e.widhei[0],e.widhei[1]),e.freearr[e.freecount].push(e.nordraw),e.dragging=!1,e.freecount++},!1),this.keyupevent()}},{key:"keyupevent",value:function(){var e=this.cfg;document.onkeyup=function(t){var r=t||window.event;if(r.preventDefault(),r.shiftKey&&"90"==r.keyCode)e.freeflag?(e.freeXY.length<=1?(e.freecount=0,e.freeXY.splice(e.freeXY.length-1,1),e.freearr.splice(e.freearr.length-1,1),e.imgarr&&e.forcxt.putImageData(e.imgarr[e.imgarr.length-1],0,0)):(e.freecount--,e.freeXY.splice(e.freeXY.length-1,1),e.freearr.splice(e.freearr.length-1,1),e.forcxt.putImageData(e.freearr[e.freearr.length-1][0],0,0)),e.nordraw=e.forcxt.getImageData(0,0,e.widhei[0],e.widhei[1])):(--e.count,e.count<=0&&(e.count=0),e.imgarr[e.count]&&e.forcxt.putImageData(e.imgarr[e.count],0,0));else if(r.shiftKey&&"89"==r.keyCode)e.freeflag||(++e.count,e.count>e.imgarr.length-1&&(e.count=e.imgarr.length-1),e.imgarr[e.count]&&e.forcxt.putImageData(e.imgarr[e.count],0,0));else if(r.shiftKey&&"88"==r.keyCode)if(e.freeflag)e.imgarr&&e.forcxt.putImageData(e.imgarr[e.imgarr.length-1],0,0);else{for(var a=e.imgarr.length-1;a>0;a--,e.count--)e.imgarr.splice(a,1),e.bjXY.splice(a,1);e.imgarr[e.count]&&e.forcxt.putImageData(e.imgarr[e.count],0,0)}}}}]),e}();
export function CFCMBD(param) {
	return new CFCMBD(param)
}